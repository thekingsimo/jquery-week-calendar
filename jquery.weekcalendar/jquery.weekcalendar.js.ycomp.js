(function(X){var E=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var F=["January","February","March","April","May","June","July","August","September","October","November","December"];var P=86400000;var L=P*7;X.fn.weekCalendar=function(l){if(typeof l=="string"){var k=Array.prototype.slice.call(arguments,1);this.each(function(){X.data(this,"weekCalendar")[l].apply(this,k)});return this}l=X.extend({date:new Date(),businessHours:{start:8,end:18},startParam:"start",endParam:"end",newEventText:"New Event",timeslotHeight:20,defaultEventLength:2,timeslotsPerHour:4,buttons:true,buttonText:{today:"today",lastWeek:"&nbsp;&lt;&nbsp;",nextWeek:"&nbsp;&gt;&nbsp;"},draggable:function(n,m){return true},resizable:function(n,m){return true},eventClick:function(){},eventRender:function(n,m){return m},eventDrop:function(n,m){},eventResize:function(n,m){},eventNew:function(n,m){},calendarRendered:function(m){},noEvents:function(){}},l);l.timeslotsPerDay=l.timeslotsPerHour*24;l.millisPerTimeslot=P/l.timeslotsPerDay;this.each(function(){var q=X(this);function o(){Z(q);b(q,q.data("startDate"))}function n(){Z(q);b(q,new Date())}function t(){var u=new Date(q.data("startDate").getTime()-(L/6));Z(q);b(q,u)}function s(){var u=new Date(q.data("startDate").getTime()+L+(L/7));Z(q);b(q,u)}function p(u){Z(q);b(q,u)}function r(u){q.find(".cal-event").each(function(){if(X(this).data("calEvent").id===u){X(this).fadeOut(function(){X(this).remove()});return false}})}function m(u){j(u,q)}X(this).data("weekCalendar",{today:n,prevWeek:t,nextWeek:s,gotoWeek:p,refresh:o,removeEvent:r,updateEvent:m}).data("options",l);e(q);b(q);R(q);l.calendarRendered(q);X(window).resize(function(){R(q)});return X(this)})};function R(m){var l=m.data("options");if(X.isFunction(l.height)){var o=l.height(m);var k=m.find(".week-calendar-header").outerHeight();var n=m.find(".calendar-nav").outerHeight();m.find(".calendar-scrollable-grid").height(o-n-k)}}function e(l){var u=l.data("options");var s=X('<div class="week-calendar">').appendTo(l);if(u.buttons){var v='<div class="calendar-nav">                <button class="today">'+u.buttonText.today+'</button>                <button class="prev">'+u.buttonText.lastWeek+'</button>                <button class="next">'+u.buttonText.nextWeek+"</button>                </div>";X(v).appendTo(s);s.find(".calendar-nav .today").click(function(){l.weekCalendar("today")});s.find(".calendar-nav .prev").click(function(){l.weekCalendar("prevWeek")});s.find(".calendar-nav .next").click(function(){l.weekCalendar("nextWeek")})}var t='<table class="week-calendar-header"><tbody><tr><td class="time-column-header"></td>';for(var o=1;o<=7;o++){t+='<td class="day-column-header day-'+o+'"></td>'}t+='<td class="scrollbar-shim"></td></tr></tbody></table>';var q='<div class="calendar-scrollable-grid">            <table class="week-calendar-time-slots">            <tbody>            <tr>            <td class="grid-timeslot-header"></td>            <td colspan="7">            <div class="time-slot-wrapper">            <div class="time-slots">';for(var o=0;o<24;o++){for(var m=0;m<u.timeslotsPerHour-1;m++){q+='<div class="time-slot"></div>'}q+='<div class="time-slot hour-end"></div>'}q+='</div></div></td></tr><tr><td class="grid-timeslot-header">';for(var o=0;o<24;o++){var k=(u.businessHours.start<=o&&u.businessHours.end>=o)?"business-hours":"";q+='<div class="hour-header '+k+'">                    <div class="time-header-cell">'+N(o)+'<span class="am-pm">'+G(o)+"</span></div></div>"}q+="</td>";for(var o=1;o<=7;o++){q+='<td class="day-column day-'+o+'"><div class="day-column-inner"></div></td>'}q+="</tr></tbody></table></div>";X(t+q).appendTo(s);var r=s.find(".week-calendar-time-slots .day-column-inner");var p=(u.timeslotHeight*u.timeslotsPerDay);r.each(function(w,x){X(this).height(p)});s.find(".time-slot").height(u.timeslotHeight-1);var n=(u.timeslotHeight*u.timeslotsPerHour)-11;s.find(".time-header-cell").css({height:n,padding:5})}function b(l,n){var t=l.data("options");var n=n||t.date;var k=U(n);l.data("startDate",U(k));var q=A(n);l.data("endDate",i(n));var r=k;l.find(".week-calendar-header td.day-column-header").each(function(u,v){X(this).html(E[u]+"<br/>"+F[r.getMonth()]+", "+r.getDate()+", "+r.getFullYear());if(Y(r)){X(this).addClass("today")}else{X(this).removeClass("today")}r=S(r,1)});r=U(n);var s=l.find(".week-calendar-time-slots .day-column-inner");s.each(function(u,v){X(this).data("startDate",f(r));X(this).data("endDate",new Date(r.getTime()+(P-1)));if(Y(r)){X(this).parent().addClass("today")}else{X(this).parent().removeClass("today")}d(X(this),s,t);H(X(this),t);r=S(r,1)});var m=l.data("startDate");var p=l.data("endDate");if(typeof t.events=="string"){if(t.loading){t.loading(true)}var o={};o[t.startParam||"start"]=Math.round(m.getTime()/1000);o[t.endParam||"end"]=Math.round(p.getTime()/1000);X.getJSON(t.events,o,function(u){events=V(u);B(events,s,t);if(t.loading){t.loading(false)}})}else{if(X.isFunction(t.events)){t.events(m,p,function(u){events=V(u);B(events,s,t)})}else{if(t.events){B(V(t.events),s,t)}}}K(s);C(l,new Date().getHours())}function B(m,k,l){X.each(m,function(o,p){var n=c(p,k);if(n){M(p,n,l)}});if(!k.find(".cal-event:first").length){l.noEvents()}}function c(m,l){var k;l.each(function(){if(X(this).data("startDate").getTime()<=m.start.getTime()&&X(this).data("endDate").getTime()>=m.end.getTime()){k=X(this);return false}});return k}function j(o,m){var l=m.data("options");I(o);var n;m.find(".cal-event").each(function(){if(X(this).data("calEvent").id===o.id){X(this).remove();return false}});var k=c(o,m.find(".week-calendar-time-slots .day-column-inner"));if(k){M(o,k,l)}}function M(r,m,u){var t='<div class="cal-event ui-corner-all">            <div class="time ui-corner-all"></div>            <div class="title"><p></p></div></div>';var n=X(t);var s=u.eventRender(r,n);n=s?s.appendTo(m):n.appendTo(m);n.css({lineHeight:(u.timeslotHeight-2)+"px",fontSize:(u.timeslotHeight/2)+"px"});T(r,n);var p=m.height()/P;var o=r.start.getTime()-new Date(r.start.getFullYear(),r.start.getMonth(),r.start.getDate()).getTime();var l=r.end.getTime()-r.start.getTime();var q=p*o;var k=p*l;n.css({top:q,height:k}).show();n.mousedown(function(v){m.data("mousedown.preventCreate",true);setTimeout(function(){m.removeData("mousedown.preventCreate")},500)}).mouseup(function(v){m.data("mouseup.preventCreate",true);setTimeout(function(){m.removeData("mouseup.preventCreate")},500)});n.click(function(v){if(!n.data("preventClickEvent")){u.eventClick(r,n,v)}}).mouseover(function(v){u.eventMouseover(r,n,v)}).mouseout(function(v){u.eventMouseout(r,n,v)});if(u.resizable(r,n)){O(r,n,m,u)}if(u.draggable(r,n)){J(r,n,m,u)}return n}function H(k,l){k.mousedown(function(q){if(X(this).data("mousedown.preventCreate")){return }var o=X('<div class="new-cal-event "><div>'+l.newEventText+"</div></div>");o.css({lineHeight:(l.timeslotHeight-2)+"px",fontSize:(l.timeslotHeight/2)+"px"});X(this).append(o);var p=X(this).offset().top;var r=q.pageY-p;var m=(r-(r%l.timeslotHeight))/l.timeslotHeight;var n=m*l.timeslotHeight;o.css({top:n});X(this).bind("mousemove.newevent",function(u){o.show();o.data("dragged",true);var s=Math.round(u.pageY-p-n);var v=s%l.timeslotHeight;if(v<(s/2)){var t=s-v;o.css("height",t<l.timeslotHeight?l.timeslotHeight:t)}else{o.css("height",s+(l.timeslotHeight-v))}}).mouseup(function(){X(this).unbind("mousemove.newevent");o.addClass("ui-corner-all")})}).mouseup(function(){if(X(this).data("mouseup.preventCreate")||X(this).data("preventClickEvent")){return }var n=X(this).find(".new-cal-event");if(!n.data("dragged")){n.css({height:l.timeslotHeight*l.defaultEventLength}).show()}if(n.length){var o=parseInt(n.css("top"));var m=a(k,n,o,l);l.eventNew(m,n)}})}function a(k,o,n,m){var p=new Date(k.data("startDate").getTime()+Math.round(n/m.timeslotHeight)*m.millisPerTimeslot);var l=new Date(p.getTime()+(o.height()/m.timeslotHeight)*m.millisPerTimeslot);return{start:p,end:l}}function d(k,l,m){k.droppable({accept:".cal-event",drop:function(p,q){var s=q.draggable;var r=Math.round(parseInt(q.position.top));var n=a(k,s,r,m);var t=s.data("calEvent");t.start=n.start;t.end=n.end;s.hide();var o=M(t,k,m);m.eventDrop(t,o);o.data("preventClickEvent",true);setTimeout(function(){o.removeData("preventClickEvent");s.remove()},500)}})}function J(n,m,k,l){m.draggable({handle:".time",containment:".calendar-scrollable-grid",opacity:0.5,grid:[m.outerWidth()+1,l.timeslotHeight]})}function O(n,m,k,l){m.resizable({grid:l.timeslotHeight,containment:k,handles:"s",minHeight:l.timeslotHeight,stop:function(p,q){var r=q.element;var o=new Date(r.data("calEvent").start.getTime()+(r.height()/l.timeslotHeight)*l.millisPerTimeslot);n.end=o;T(n,r);l.eventResize(n,r);r.data("preventClickEvent",true);setTimeout(function(){r.removeData("preventClickEvent")},500)}})}function T(l,k){k.data("calEvent",l);k.find(".time").text(D(l.start)+" to "+D(l.end));k.find(".title p").text(l.title)}function Z(k){k.find(".day-column-inner div").remove()}function C(o,m){var n=o.find(".calendar-scrollable-grid");var l=o.find(".grid-timeslot-header .hour-header:eq("+m+")");var p=l.offset().top;var k=p-n.offset().top-l.outerHeight();n.animate({scrollTop:k},500)}function D(k){return g(N(k.getHours()),2)+":"+g(k.getMinutes(),2)+" "+G(k.getHours())}function N(k){if(k===0){return 12}else{if(k<13){return k}else{return k-12}}}function G(k){return k<12?"AM":"PM"}function Y(l){var m=f(l);Q(m);var k=new Date();Q(k);return k.getTime()===m.getTime()}function V(k){X.each(k,function(l,m){I(m)});return k}function I(k){if(k.date){k.start=k.date}k.start=W(k.start);k.end=W(k.end);if(!k.end){k.end=S(f(k.start),1)}}function K(k){k.each(function(){if(X.browser.mozilla){X(this).css("MozUserSelect","none")}else{if(X.browser.msie){X(this).bind("selectstart",function(){return false})}else{X(this).mousedown(function(){return false})}}})}function U(l){var m=new Date(l.getFullYear(),l.getMonth(),l.getDate());var k=m.getDay();var n=k*86400000;return new Date(m.getTime()-n)}function A(l){var m=new Date(l.getFullYear(),l.getMonth(),l.getDate());var k=m.getDay();var n=(6-k)*P;return new Date(m.getTime()+n)}function i(k){var l=A(k);return new Date(l.getTime()+(P-1))}function g(o,l){var n=(""+o).length;var m=""+o;for(var k=0;k<l-n;k++){m="0"+m}return m}function Q(k){k.setHours(0);k.setMinutes(0);k.setSeconds(0);k.setMilliseconds(0);return k}function S(l,m,k){l.setDate(l.getDate()+m);if(k){return l}return Q(l)}function f(k){return new Date(+k)}function W(k){if(typeof k=="string"){return X.parseISO8601(k,true)||Date.parse(k)||new Date(parseInt(k))}if(typeof k=="number"){return new Date(k)}return k}X.parseISO8601=function(m,k){var n="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var p=m.match(new RegExp(n));if(!p){return null}var o=0;var l=new Date(p[1],0,1);if(p[3]){l.setMonth(p[3]-1)}if(p[5]){l.setDate(p[5])}if(p[7]){l.setHours(p[7])}if(p[8]){l.setMinutes(p[8])}if(p[10]){l.setSeconds(p[10])}if(p[12]){l.setMilliseconds(Number("0."+p[12])*1000)}if(!k){if(p[14]){o=(Number(p[16])*60)+Number(p[17]);o*=((p[15]=="-")?1:-1)}o-=l.getTimezoneOffset()}return new Date(Number(l)+(o*60*1000))};X.ISO8601String=function(k){var l=function(m){return((m<10)?"0":"")+m};return k.getUTCFullYear()+"-"+l(k.getUTCMonth()+1)+"-"+l(k.getUTCDate())+"T"+l(k.getUTCHours())+":"+l(k.getUTCMinutes())+":"+l(k.getUTCSeconds())+"Z"}})(jQuery);