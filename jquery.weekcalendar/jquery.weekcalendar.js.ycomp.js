(function(X){var E=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var F=["January","February","March","April","May","June","July","August","September","October","November","December"];var P=86400000;var L=P*7;X.fn.weekCalendar=function(l){if(typeof l=="string"){var k=Array.prototype.slice.call(arguments,1);this.each(function(){X.data(this,"weekCalendar")[l].apply(this,k)});return this}l=X.extend({date:new Date(),businessHours:{start:8,end:18},startParam:"start",endParam:"end",newEventText:"New Event",timeslotHeight:20,defaultEventLength:2,timeslotsPerHour:4,buttons:true,scrollToHourMillis:500,buttonText:{today:"today",lastWeek:"&nbsp;&lt;&nbsp;",nextWeek:"&nbsp;&gt;&nbsp;"},draggable:function(n,m){return true},resizable:function(n,m){return true},eventClick:function(){},eventRender:function(n,m){return m},eventDrop:function(n,m){},eventResize:function(n,m){},eventNew:function(n,m){},calendarBeforeLoad:function(m){},calendarAfterLoad:function(m){},noEvents:function(){}},l);l.timeslotsPerDay=l.timeslotsPerHour*24;l.millisPerTimeslot=P/l.timeslotsPerDay;return this.each(function(){var m=X(this);function s(){Z(m);b(m,m.data("startDate"))}function r(){Z(m);b(m,new Date())}function u(){var v=new Date(m.data("startDate").getTime()-(L/6));Z(m);b(m,v)}function n(){var v=new Date(m.data("startDate").getTime()+L+(L/7));Z(m);b(m,v)}function o(v){Z(m);b(m,v)}function q(v){m.find(".cal-event").each(function(){if(X(this).data("calEvent").id===v){X(this).fadeOut(function(){X(this).remove()});return false}})}function p(){m.find(".new-cal-event").fadeOut(function(){X(this).remove()})}function t(v){j(v,m)}X(this).data("weekCalendar",{today:r,prevWeek:u,nextWeek:n,gotoWeek:o,refresh:s,removeEvent:q,updateEvent:t,removeUnsavedEvents:p}).data("options",l);e(m);b(m);R(m);X(window).unbind("resize.weekcalendar");X(window).bind("resize.weekcalendar",function(){R(m)});return X(this)})};function R(m){var l=m.data("options");if(l&&X.isFunction(l.height)){var o=l.height(m);var k=m.find(".week-calendar-header").outerHeight();var n=m.find(".calendar-nav").outerHeight();m.find(".calendar-scrollable-grid").height(o-n-k)}}function e(l){var u=l.data("options");var s=X('<div class="week-calendar">').appendTo(l);if(u.buttons){var v='<div class="calendar-nav">                <button class="today">'+u.buttonText.today+'</button>                <button class="prev">'+u.buttonText.lastWeek+'</button>                <button class="next">'+u.buttonText.nextWeek+"</button>                </div>";X(v).appendTo(s);s.find(".calendar-nav .today").click(function(){l.weekCalendar("today")});s.find(".calendar-nav .prev").click(function(){l.weekCalendar("prevWeek")});s.find(".calendar-nav .next").click(function(){l.weekCalendar("nextWeek")})}var t='<table class="week-calendar-header"><tbody><tr><td class="time-column-header"></td>';for(var o=1;o<=7;o++){t+='<td class="day-column-header day-'+o+'"></td>'}t+='<td class="scrollbar-shim"></td></tr></tbody></table>';var q='<div class="calendar-scrollable-grid">            <table class="week-calendar-time-slots">            <tbody>            <tr>            <td class="grid-timeslot-header"></td>            <td colspan="7">            <div class="time-slot-wrapper">            <div class="time-slots">';for(var o=0;o<24;o++){for(var m=0;m<u.timeslotsPerHour-1;m++){q+='<div class="time-slot"></div>'}q+='<div class="time-slot hour-end"></div>'}q+='</div></div></td></tr><tr><td class="grid-timeslot-header">';for(var o=0;o<24;o++){var k=(u.businessHours.start<=o&&u.businessHours.end>=o)?"business-hours":"";q+='<div class="hour-header '+k+'">                    <div class="time-header-cell">'+N(o)+'<span class="am-pm">'+G(o)+"</span></div></div>"}q+="</td>";for(var o=1;o<=7;o++){q+='<td class="day-column day-'+o+'"><div class="day-column-inner"></div></td>'}q+="</tr></tbody></table></div>";X(t+q).appendTo(s);var r=s.find(".week-calendar-time-slots .day-column-inner");var p=(u.timeslotHeight*u.timeslotsPerDay);r.each(function(w,x){X(this).height(p)});s.find(".time-slot").height(u.timeslotHeight-1);var n=(u.timeslotHeight*u.timeslotsPerHour)-11;s.find(".time-header-cell").css({height:n,padding:5})}function b(l,n){var u=l.data("options");var t=[];var n=n||u.date;var k=U(n);u.calendarBeforeLoad(l);l.data("startDate",U(k));var q=A(n);l.data("endDate",i(n));var r=k;l.find(".week-calendar-header td.day-column-header").each(function(v,w){X(this).html(E[v]+"<br/>"+F[r.getMonth()]+", "+r.getDate()+", "+r.getFullYear());if(Y(r)){X(this).addClass("today")}else{X(this).removeClass("today")}r=S(r,1)});r=U(n);var s=l.find(".week-calendar-time-slots .day-column-inner");s.each(function(v,w){X(this).data("startDate",f(r));X(this).data("endDate",new Date(r.getTime()+(P-1)));if(Y(r)){X(this).parent().addClass("today")}else{X(this).parent().removeClass("today")}d(X(this),s,u);H(X(this),u);r=S(r,1)});var m=l.data("startDate");var p=l.data("endDate");if(typeof u.events=="string"){if(u.loading){u.loading(true)}var o={};o[u.startParam||"start"]=Math.round(m.getTime()/1000);o[u.endParam||"end"]=Math.round(p.getTime()/1000);X.getJSON(u.events,o,function(v){t=V(v);B(t,s,l);if(u.loading){u.loading(false)}})}else{if(X.isFunction(u.events)){u.events(m,p,function(v){t=V(v);B(t,s,l)})}else{if(u.events){t=V(u.events);B(t,s,l)}}}K(s);C(l,new Date().getHours())}function B(m,k,n){var l=n.data("options");X.each(m,function(p,q){var o=c(q,k);if(o){M(q,o,l)}});l.calendarAfterLoad(n);if(!m.length){l.noEvents()}}function c(m,l){var k;l.each(function(){if(X(this).data("startDate").getTime()<=m.start.getTime()&&X(this).data("endDate").getTime()>=m.end.getTime()){k=X(this);return false}});return k}function j(o,m){var l=m.data("options");I(o);var n;if(o.id){m.find(".cal-event").each(function(){if(X(this).data("calEvent").id===o.id||X(this).hasClass("new-cal-event")){X(this).remove();return false}})}var k=c(o,m.find(".week-calendar-time-slots .day-column-inner"));if(k){M(o,k,l)}}function M(r,m,v){var s=r.id?"cal-event":"cal-event new-cal-event";var u='<div class="'+s+' ui-corner-all">            <div class="time ui-corner-all"></div>            <div class="title"><p></p></div></div>';var o=X(u);var t=v.eventRender(r,o);o=t?t.appendTo(m):o.appendTo(m);o.css({lineHeight:(v.timeslotHeight-2)+"px",fontSize:(v.timeslotHeight/2)+"px"});T(r,o);var p=m.height()/P;var n=r.start.getTime()-new Date(r.start.getFullYear(),r.start.getMonth(),r.start.getDate()).getTime();var l=r.end.getTime()-r.start.getTime();var q=p*n;var k=p*l;o.css({top:q,height:k}).show();o.mousedown(function(w){m.data("mousedown.preventCreate",true);setTimeout(function(){m.removeData("mousedown.preventCreate")},500)}).mouseup(function(w){m.data("mouseup.preventCreate",true);setTimeout(function(){m.removeData("mouseup.preventCreate")},500)});o.click(function(w){if(!o.data("preventClickEvent")){v.eventClick(r,o,w)}}).mouseover(function(w){v.eventMouseover(r,o,w)}).mouseout(function(w){v.eventMouseout(r,o,w)});if(v.resizable(r,o)){O(r,o,m,v)}if(v.draggable(r,o)){J(r,o,m,v)}return o}function H(k,l){k.mousedown(function(q){if(X(this).data("mousedown.preventCreate")){return }var o=X('<div class="new-cal-event"></div>');o.css({lineHeight:(l.timeslotHeight-2)+"px",fontSize:(l.timeslotHeight/2)+"px"});X(this).append(o);var p=X(this).offset().top;var r=q.pageY-p;var m=(r-(r%l.timeslotHeight))/l.timeslotHeight;var n=m*l.timeslotHeight;o.css({top:n});X(this).bind("mousemove.newevent",function(u){o.show();o.data("dragged",true);var s=Math.round(u.pageY-p-n);var v=s%l.timeslotHeight;if(v<(s/2)){var t=s-v;o.css("height",t<l.timeslotHeight?l.timeslotHeight:t)}else{o.css("height",s+(l.timeslotHeight-v))}}).mouseup(function(){X(this).unbind("mousemove.newevent");o.addClass("ui-corner-all")})}).mouseup(function(){if(X(this).data("mouseup.preventCreate")||X(this).data("preventClickEvent")){return }var p=X(this).find(".new-cal-event");if(!p.data("dragged")){p.css({height:l.timeslotHeight*l.defaultEventLength}).show()}if(p.length){var q=parseInt(p.css("top"));var m=a(k,p,q,l);p.remove();var o={start:m.start,end:m.end,title:l.newEventText};var n=M(o,k,l);l.eventNew(m,n)}})}function a(k,o,n,m){var p=new Date(k.data("startDate").getTime()+Math.round(n/m.timeslotHeight)*m.millisPerTimeslot);var l=new Date(p.getTime()+(o.height()/m.timeslotHeight)*m.millisPerTimeslot);return{start:p,end:l}}function d(k,l,m){k.droppable({accept:".cal-event",drop:function(q,r){var t=r.draggable;var s=Math.round(parseInt(r.position.top));var n=a(k,t,s,m);var u=t.data("calEvent");var p=X.extend(true,{start:n.start,end:n.end},u);t.data("calEvent",p);t.hide();var o=M(p,k,m);m.eventDrop(p,u,o);o.data("preventClickEvent",true);setTimeout(function(){o.removeData("preventClickEvent");t.remove()},500)}})}function J(n,m,k,l){m.draggable({handle:".time",containment:".calendar-scrollable-grid",opacity:0.5,grid:[m.outerWidth()+1,l.timeslotHeight]})}function O(n,m,k,l){m.resizable({grid:l.timeslotHeight,containment:k,handles:"s",minHeight:l.timeslotHeight,stop:function(q,r){var s=r.element;var p=new Date(s.data("calEvent").start.getTime()+(s.height()/l.timeslotHeight)*l.millisPerTimeslot);var o=X.extend(true,{start:n.start,end:p},n);T(o,s);l.eventResize(o,n,s);s.data("preventClickEvent",true);setTimeout(function(){s.removeData("preventClickEvent")},500)}})}function T(l,k){k.data("calEvent",l);k.find(".time").text(D(l.start)+" to "+D(l.end));k.find(".title p").text(l.title)}function Z(k){k.find(".day-column-inner div").remove()}function C(o,l){var m=o.data("options");var n=o.find(".calendar-scrollable-grid");var k=o.find(".grid-timeslot-header .hour-header:eq("+l+")");n.animate({scrollTop:0},0,function(){var q=k.offset().top;var p=q-n.offset().top-k.outerHeight();n.animate({scrollTop:p},m.scrollToHourMillis)})}function D(k){return g(N(k.getHours()),2)+":"+g(k.getMinutes(),2)+" "+G(k.getHours())}function N(k){if(k===0){return 12}else{if(k<13){return k}else{return k-12}}}function G(k){return k<12?"AM":"PM"}function Y(l){var m=f(l);Q(m);var k=new Date();Q(k);return k.getTime()===m.getTime()}function V(k){X.each(k,function(l,m){I(m)});return k}function I(k){if(k.date){k.start=k.date}k.start=W(k.start);k.end=W(k.end);if(!k.end){k.end=S(f(k.start),1)}}function K(k){k.each(function(){if(X.browser.mozilla){X(this).css("MozUserSelect","none")}else{if(X.browser.msie){X(this).bind("selectstart",function(){return false})}else{X(this).mousedown(function(){return false})}}})}function U(l){var m=new Date(l.getFullYear(),l.getMonth(),l.getDate());var k=m.getDay();var n=k*86400000;return new Date(m.getTime()-n)}function A(l){var m=new Date(l.getFullYear(),l.getMonth(),l.getDate());var k=m.getDay();var n=(6-k)*P;return new Date(m.getTime()+n)}function i(k){var l=A(k);return new Date(l.getTime()+(P-1))}function g(o,l){var n=(""+o).length;var m=""+o;for(var k=0;k<l-n;k++){m="0"+m}return m}function Q(k){k.setHours(0);k.setMinutes(0);k.setSeconds(0);k.setMilliseconds(0);return k}function S(l,m,k){l.setDate(l.getDate()+m);if(k){return l}return Q(l)}function f(k){return new Date(+k)}function W(k){if(typeof k=="string"){return X.parseISO8601(k,true)||Date.parse(k)||new Date(parseInt(k))}if(typeof k=="number"){return new Date(k)}return k}X.parseISO8601=function(m,k){var n="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var p=m.match(new RegExp(n));if(!p){return null}var o=0;var l=new Date(p[1],0,1);if(p[3]){l.setMonth(p[3]-1)}if(p[5]){l.setDate(p[5])}if(p[7]){l.setHours(p[7])}if(p[8]){l.setMinutes(p[8])}if(p[10]){l.setSeconds(p[10])}if(p[12]){l.setMilliseconds(Number("0."+p[12])*1000)}if(!k){if(p[14]){o=(Number(p[16])*60)+Number(p[17]);o*=((p[15]=="-")?1:-1)}o-=l.getTimezoneOffset()}return new Date(Number(l)+(o*60*1000))};X.ISO8601String=function(k){var l=function(m){return((m<10)?"0":"")+m};return k.getUTCFullYear()+"-"+l(k.getUTCMonth()+1)+"-"+l(k.getUTCDate())+"T"+l(k.getUTCHours())+":"+l(k.getUTCMinutes())+":"+l(k.getUTCSeconds())+"Z"}})(jQuery);